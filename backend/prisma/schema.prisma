generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  password  String
  email     String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  gamesAsPlayer1 Game[] @relation("Player1Games")
  gamesAsPlayer2 Game[] @relation("Player2Games")
  gamesAsWinner  Game[] @relation("WinnerGames")
  sessions  GameSession[]
}

model Game {
  id        Int       @id @default(autoincrement())
  player1Id Int
  player2Id Int?
  winnerId  Int?
  status    String    @default("active")
  moves     Json[] // Store moves as JSON array (e.g., [{position: "A0", player: "X"}])
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  player1   User      @relation("Player1Games", fields: [player1Id], references: [id])
  player2   User?     @relation("Player2Games", fields: [player2Id], references: [id])
  winner    User?     @relation("WinnerGames", fields: [winnerId], references: [id])
  sessions  GameSession[]
}

model GameSession {
  id        Int       @id @default(autoincrement())
  userId    Int
  gameId    Int
  socketId  String
  createdAt DateTime  @default(now())
  user      User      @relation(fields: [userId], references: [id])
  game      Game      @relation(fields: [gameId], references: [id])
}
